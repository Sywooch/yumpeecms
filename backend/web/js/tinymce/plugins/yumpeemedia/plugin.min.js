/* 
 * Author : Peter Odon
 * Email : peter@audmaster.com
 * Each line should be prefixed with  * 
 */

tinymce.PluginManager.add('yumpeemedia', function(editor, url) {
  // Add a button that opens a window
  editor.addButton('yumpeemedia', {
    text: '',
    tooltip: "Insert Image(s)",
    icon: 'image',
    onclick: function() {
      // Open window
      editor.windowManager.open({
        title: 'Yumpee Media',
        url: 'index.php?r=media/insert-media&exempt_the_headers_in_yumpee=true',
        width: 1200,
        height: 800,
        buttons: [{text: 'Insert Media',
          onclick: function(e) {
          // Insert content when the window form is submitted
          var file_list="";
          var name = "yumpee_image=";
          var decodedCookie = decodeURIComponent(document.cookie);
          var ca = decodedCookie.split(';');
          for(var i = 0; i <ca.length; i++) {
                var c = ca[i];
                while (c.charAt(0) == ' ') {
                    c = c.substring(1);
                }
                if (c.indexOf(name) == 0) {
                    file_list= c.substring(name.length, c.length);
                }
          }
          if(file_list != ""){
              var file_arr = file_list.split(" ");
              for(i=0; i < file_arr.length;i++){
                tinymce.activeEditor.insertContent('<img alt="Smiley faces" height="100" width="100" src="' + file_arr[i] + '"></img>');
            }
          }
          var ed = parent.tinymce.editors[0];
          ed.windowManager.windows[0].close();
        }},{
          text: 'Close',
          onclick: 'close'
        }]
      });
    }
  });

  // Adds a menu item to the tools menu
  editor.addMenuItem('yumpeemedia', {
    text: 'Add Image / Media',
    context: 'tools',
    onclick: function() {
      // Open window with a specific url
      editor.windowManager.open({
        title: 'Yumpee Media',
        url: 'index.php?r=media/insert-media&exempt_the_headers_in_yumpee=true',
        width: 1200,
        height: 800,
        buttons: [{text: 'Insert Media',
          onclick: function(e) {
          // Insert content when the window form is submitted
          var file_list="";
          var name = "yumpee_image=";
          var decodedCookie = decodeURIComponent(document.cookie);
          var ca = decodedCookie.split(';');
          for(var i = 0; i <ca.length; i++) {
                var c = ca[i];
                while (c.charAt(0) == ' ') {
                    c = c.substring(1);
                }
                if (c.indexOf(name) == 0) {
                    file_list= c.substring(name.length, c.length);
                }
          }
          if(file_list != ""){
              var file_arr = file_list.split(" ");
              for(i=0; i < file_arr.length;i++){
                tinymce.activeEditor.insertContent('<img alt="Yumpee Image" height="60" width="60" src="' + file_arr[i] + '"></img>');
            }
          }
          var ed = parent.tinymce.editors[0];
          ed.windowManager.windows[0].close();
        }},{
          text: 'Close',
          onclick: 'close'
        }]
      });
    }
  });

  return {
    getMetadata: function () {
      return  {
        title: "Example plugin",
        url: "http://exampleplugindocsurl.com"
      };
    }
  };
});

